#################################################
# GREECE, BYZANTIUM, AND THE BALKANS ON_ACTIONS #
#################################################

on_monthly_pulse_country = {
	on_actions = {
		eocfm_catholic_monthly_pulse
		eocfm_orthodox_monthly_pulse
		eocfm_oriental_monthly_pulse
		eocfm_elysian_monthly_pulse
		eocfm_global_pulse
	}
}

on_wargoal_enforced = {
	on_actions = {
		eocfm_wargoal_enforced_1
		eocfm_wargoal_enforced_2
	}
}

############

eocfm_catholic_monthly_pulse = {
	trigger = {
		eocfm_is_roman_catholic_trigger = yes
	}
	on_actions = {
		eocfm_schism_monthly_pulse
		eocfm_integration_monthly_pulse
		eocfm_mending_monthly_pulse
	}
	events = {
		eocfm.1000 # Catholic Opener Monitor
	}
	random_events = {
	}
	effect = {
		eocfm_update_holy_site_count_effect = yes
		eocfm_update_patriarch_variables_effect = yes
		eocfm_update_patriarch_opinions_effect = yes
		eocfm_update_rite_modifiers_effect = yes
		eocfm_update_seat_controllers_effect = yes
		eocfm_update_approval_bonus_effect = yes
		eocfm_check_patriarch_modifiers_effect = yes
	}
}

eocfm_orthodox_monthly_pulse = {
	trigger = {
		OR = {
			eocfm_is_eastern_orthodox_trigger = yes
			eocfm_is_rus_orthodox_trigger = yes
		}
	}
	on_actions = {
		eocfm_schism_monthly_pulse
		eocfm_integration_monthly_pulse
		eocfm_mending_monthly_pulse
	}
	events = {
		eocfm.2000 # Orthodox Opener Monitor
	}
	random_events = {
		chance_of_no_event = 95
		5 = eocfm.010 # Ecumenical Reforms
		5 = eocfm.011 # Bible Translation Published
		5 = eocfm.012 # A Heretical Ruler
		5 = eocfm.030 # Dissolution of the Monasteries
		5 = eocfm.031 # Church-State Relations
		5 = eocfm.040 # Priestly Excesses	
		5 = eocfm.041 # The Widow's Mite
		5 = eocfm.150 # Ecumenical Financing
		5 = eocfm.151 # Delegation Arrives from Seat
		5 = eocfm.162 # Ecumenical Partiarch Denounces Secularism
		5 = eocfm.170 # Patriarch Condemns Immorality
		5 = eocfm.171 # Theological Dispute with Patriarch
	}
	effect = {
		eocfm_update_holy_site_count_effect = yes
		eocfm_update_patriarch_variables_effect = yes
		eocfm_update_patriarch_opinions_effect = yes
		eocfm_update_rite_modifiers_effect = yes
		eocfm_update_seat_controllers_effect = yes
		eocfm_update_approval_bonus_effect = yes
		eocfm_check_patriarch_modifiers_effect = yes
		if = { # Adds the Orthodox button to the community sidebar
			limit = {
				NOT = {
					is_target_in_global_variable_list = {
						name = custom_button_list_flag
						target = flag:eocfm_sidebar_button_sgui
					}
				}
			}
			add_to_global_variable_list = {
				name = custom_button_list_flag
				target = flag:eocfm_sidebar_button_sgui
			}
		}
	}
}

eocfm_oriental_monthly_pulse = {
	trigger = {
		eocfm_is_oriental_orthodox_trigger = yes
	}
	on_actions = {
		eocfm_schism_monthly_pulse
		eocfm_integration_monthly_pulse
		eocfm_mending_monthly_pulse
	}
	events = {
	}
	random_events = {
	}
	effect = {
		eocfm_update_holy_site_count_effect = yes
		eocfm_update_patriarch_variables_effect = yes
		eocfm_update_patriarch_opinions_effect = yes
		eocfm_update_rite_modifiers_effect = yes
		eocfm_update_seat_controllers_effect = yes
		eocfm_update_approval_bonus_effect = yes
		eocfm_check_patriarch_modifiers_effect = yes
	}
}

eocfm_elysian_monthly_pulse = {
	trigger = {
		eocfm_is_elysian_orthodox_trigger = yes
	}
	on_actions = {
		eocfm_schism_monthly_pulse
		eocfm_integration_monthly_pulse
		eocfm_mending_monthly_pulse
	}
	events = {
	}
	random_events = {
	}
	effect = {
		eocfm_update_holy_site_count_effect = yes
		eocfm_update_patriarch_variables_effect = yes
		eocfm_update_patriarch_opinions_effect = yes
		eocfm_update_rite_modifiers_effect = yes
		eocfm_update_seat_controllers_effect = yes
		eocfm_update_approval_bonus_effect = yes
		eocfm_check_patriarch_modifiers_effect = yes
	}
}

eocfm_schism_monthly_pulse = {
	trigger = {
		has_variable = eocfm_schism_var
	}
	events = {
		eocfm.107 # Autocephaly Completion Technical Event # Yes Doodlez, I'm disappointed in myself too
	}
	random_events = {
		chance_of_no_event = 90
		10 = eocfm.180 # Traditionalists March in Capital (Stall Event)
		10 = eocfm.181 # A Church for the Nation (Progress Event)
		10 = eocfm.182 # Minority Adherents Seek Protections (Debate Event)
		10 = eocfm.183 # Patriarch Denounces Schism (Stall Event)
		10 = eocfm.184 # Liturgical Language (Debate Event)
		10 = eocfm.185 # Ecclesiatic Purges (Advance Event)
		10 = eocfm.186 # Promoting Local Bishops (Advance Event)
		10 = eocfm.187 # Monastic Brawls (Stall Event)
		10 = eocfm.188 # Agitator Condemns Schism (Stall Event)
		10 = eocfm.189 # Prominent Priest Assassinated (Stall Event)
	}
	effect = {
		change_variable = {
			name = eocfm_schism_var
			add = eocfm_schism_progress_value
		}
	}
}

eocfm_integration_monthly_pulse = {
	trigger = {
		has_variable = eocfm_integration_var
	}
	events = {
		eocfm.120 # Rome Usurped by Country
		eocfm.121 # Santiago Usurped by Country
		eocfm.122 # Paris Usurped by Country
		eocfm.123 # Koln Usurped by Country
		eocfm.124 # Vienna Usurped by Country
		eocfm.125 # Constantinopole Usurped by Country
		eocfm.126 # Antioch Usurped by Country
		eocfm.127 # Jerusalem Usurped by Country
		eocfm.128 # Alexandria Usurped by Country
		eocfm.129 # Moscow Usurped by Country
		eocfm.130 # Coptic Alexandria Usurped by Country
		eocfm.131 # Syriac Alexandria Usurped by Country
		eocfm.132 # Etchmiadzin Usurped by Country
		eocfm.133 # Addis Ababa Usurped by Country
		eocfm.134 # Qudshanis Usurped by Country
		eocfm.135 # Elysium Usurped by Country
		eocfm.136 # Tututepec Usurped by Country
		eocfm.137 # Cahokia Usurped by Country
	}
	random_events = {
		chance_of_no_event = 95
		5 = eocfm.140 # Seat Integration Disputed
	}
	effect = {
		if = {
			limit = {
				has_variable = eocfm_integration_var
			}
			change_variable = {
				name = eocfm_integration_var
				add = 1
			}
		}
	}
}

eocfm_mending_monthly_pulse = {
	trigger = {
		has_variable = eocfm_mending_var
	}
	events = {
		eocfm.309 # The Supreme Pontiff of the Universal Church
	}
	effect = {
		change_variable = {
			name = eocfm_mending_var
			add = 1
		}
	}
}

eocfm_global_pulse = { # Monitored from all scopes; used to deactivate holy sites
	events = {
		eocfm.010 # Rome PM Switch
		eocfm.011 # Santiago PM Switch
		eocfm.012 # Paris PM Switch
		eocfm.013 # Koln PM Switch
		eocfm.014 # Vienna PM Switch
		eocfm.015 # Constantinopole PM Switch
		eocfm.016 # Antioch PM Switch
		eocfm.017 # Jerusalem PM Switch
		eocfm.018 # Alexandria PM Switch
		eocfm.019 # Moscow PM Switch
		eocfm.020 # Coptic Alexandria PM Switch
		eocfm.021 # Syriac Alexandria PM Switch
		eocfm.022 # Etchmiadzin PM Switch
		eocfm.023 # Addis Ababa PM Switch
		eocfm.024 # Qudshanis PM Switch
		eocfm.025 # Elysium PM Switch
		eocfm.026 # Tututepec PM Switch
		eocfm.027 # Cahokia PM Switch
	}
}

############

eocfm_wargoal_enforced_1 = { # From the initiator, in the case of crusade success
	trigger = {
		has_variable = eocfm_crusade_initiator
		scope:target = {
			has_variable = eocfm_crusade_target
		}
	}
	effect = {
		remove_global_variable = eocfm_crusade_var
		every_country = {
			limit = {
				eocfm_crusade_participant_trigger = yes
			}
			trigger_event = {
				id = eocfm.131 # Victorious Crusade
			}
			eocfm_crusade_cleanup_effect = yes
		}
	}
}

eocfm_wargoal_enforced_2 = { # From the target, in the case of crusade failure
	trigger = {
		has_variable = eocfm_crusade_target
		scope:target = {
			has_variable = eocfm_crusade_initiator
		}
	}
	effect = {
		remove_global_variable = eocfm_crusade_var
		every_country = {
			limit = {
				eocfm_crusade_participant_trigger = yes
			}
			trigger_event = {
				id = eocfm.132 # Failed Crusade
			}
			eocfm_crusade_cleanup_effect = yes
		}
	}
}
